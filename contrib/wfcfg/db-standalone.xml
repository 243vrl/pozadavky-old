<?xml version="1.0" ?>

<server xmlns="urn:jboss:domain:4.2">

        <subsystem xmlns="urn:jboss:domain:datasources:4.0">
                <datasource jndi-name="java:jboss/PozadavkyDS" enabled="true" use-java-context="true" pool-name="pozadavkyDSpool" use-ccm="true">
                    <connection-url>jdbc:postgresql://postgrsql:5432/pozadavky</connection-url>
                    <driver>postgresql</driver>
                    <security>
                      <user-name>name</user-name>
                      <password>ccccc</password>
                    </security>
                    <validation>
                        <check-valid-connection-sql>SELECT 1</check-valid-connection-sql>
                        <background-validation>true</background-validation>
                        <background-validation-millis>60000</background-validation-millis>
                        <!--<validate-on-match>true</validate-on-match>-->
                    </validation>
                    <pool>
                        <flush-strategy>IdleConnections</flush-strategy>
                    </pool>
                </datasource>
                <drivers>
                    <driver name="postgresql" module="org.postgresql.jdbc">
                        <xa-datasource-class>org.postgresql.xa.PGXADataSource</xa-datasource-class>
                    </driver>
                </drivers>
            </datasources>
        </subsystem>
		<subsystem xmlns="urn:jboss:domain:security:1.2">
            <security-domains>
                <security-domain name="other" cache-type="default">
                    <authentication>
                        <login-module code="Remoting" flag="optional">
                            <module-option name="password-stacking" value="useFirstPass"/>
                        </login-module>
                        <login-module code="RealmDirect" flag="required">
                            <module-option name="password-stacking" value="useFirstPass"/>
                        </login-module>
                    </authentication>
                </security-domain>
                <security-domain name="jboss-web-policy" cache-type="default">
                    <authorization>
                        <policy-module code="Delegating" flag="required"/>
                    </authorization>
                </security-domain>
                <security-domain name="jboss-ejb-policy" cache-type="default">
                    <authorization>
                        <policy-module code="Delegating" flag="required"/>
                    </authorization>
                </security-domain>
                <security-domain name="test-policy" cache-type="default">
                    <authentication>
                        <login-module code="Database" flag="required">
                            <module-option name="dsJndiName" value="java:jboss/PozadavkyDS"/>
                            <module-option name="principalsQuery" value="SELECT passwd FROM users WHERE username=?"/>
                            <module-option name="rolesQuery" value="SELECT role, 'Roles' FROM roles WHERE username=?"/>
                            <module-option name="hashAlgorithm" value="SHA-256"/>
                            <module-option name="hashEncoding" value="hex"/>
                            <module-option name="ignorePasswordCase" value="true"/>
                        </login-module>
                    </authentication>
                </security-domain>
            </security-domains>
        </subsystem>
</server>